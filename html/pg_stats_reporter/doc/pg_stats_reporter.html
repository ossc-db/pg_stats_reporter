<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>pg_stats_reporter</title>
<link rel="home" title="pg_stats_reporter" href="index.html">
<link rel="stylesheet" TYPE="text/css"href="style.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
<div class="index">
<ol>
  <li><a href="#name">What is pg_stats_reporter?</a></li>
  <li><a href="#synopsis">Summary</a>
  <ol>
    <li><a href="#synopsis_server">Create reports by Web browser</a></li>
    <li><a href="#synopsis_command">Create reports by command-line</a></li>
  </ol></li>
  <li><a href="#install">Install</a>
  <ol>
    <li><a href="#requirement">Requirement</a></li>
    <li><a href="#pg_stats_reporter_install">Install pg_stats_reporter</a></li>
    <li><a href="#initialize">Initial settings</a></li>
    <li><a href="#execute_test">Install cheack</a></li>
  </ol></li>
  <li><a href="#execute">Usage</a>
  <ol>
    <li><a href="#execute_server">Usage of creating reports by Web browser</a></li>
    <li><a href="#execute_command">Usage of creating reports by command-line</a></li>
  </ol></li>
  <li><a href="#uninstall">Uninstall</a></li>
  <li><a href="#configuration">Configuration</a></li>
  <li><a href="#restrictions">Restrictions and cautions</a></li>
  <li><a href="#faq">FAQ</a></li>
  <li><a href="#change">Changes from pg_stats_reporter 1.0</a></li>
  <li><a href="#seealso">See also</a></li>
  <li><a href="#acknowledgment">Acknowledgement</a></li>
</ol>
</div>
<h1 id="pg_stats_reporter">pg_stats_reporter 2.0</h1>
<h2 id="name">What is pg_stats_reporter?</h2>
<p>pg_stats_reporter can make statistical and graphical reports by <a href="http://pgstatsinfo.projects.postgresql.org/pg_statsinfo-ja.html">pg_statsinfo's(2.4 or later)</a> statistical database(we call it 'snapshot'). Example of report is <a href="files/report_sample.html">here</a> </p>

<h2 id="synopsis">Summary</h2>
<p>Pg_stats_reporter is web-based software and can make statistical and graphical reports by pg_statsinfo's snapshot which is statistic of PostgreSQL.<br/>
<p>We can create reports in two ways which are under following.</p>

<h3 id="synopsis_server">Create reports by Web browser</h3>
<p>This method can easy to create reports on Web browser, program executes on Apache HTTP Server.<br/>
If you access web server by Web browser, you can create reports by GUI on your Web browser window.</p>

<h3 id="synopsis_command">Create reports by command-line</h3>
<p>This method can create reports on command-line.<br/>
This method doesn't need Apache HTTP Server. If you cannot use Apache HTTP Server or would like to create reports by crond in specific period, you had better select this method.</p>

<h2 id="install">Install</h2>
<p>Please download <a href="http://pgfoundry.org/frs/?group_id=1000422">install package</a> of pg_stats_reporter.<br/>
If you would like to install by source package, please read the INSTALL.en file which is included in source package.</p>

<h3 id="requirement">Requirement</h3>
<dl>
  <dt>pg_statsinfo</dt>
  <dd>version 2.4 or later</dd>
  <dt>PHP</dt>
  <dd>version 5.3.3 (It's included in rpm package of OS.)</dd>
  <dt>OS</dt>
  <dd>RHEL 5.9, RHEL 6.4</dd>
  <dt>web browser</dt>
  <dd>Internet Explorer : 9, 10</dd>
  <dd>Firefox : 10.0.12, 21.0</dd>
  <dd>Google Chrome : 27.0.1453.110 m</dd>
  <dd>Safari (Windows) : 5.1.7</dd>
  <dt>HTTP Server</dt>
  <dd>Apache HTTP Server : 2.2.3 (It's included in RHEL 5.9), 2.2.15 (It's included in RHEL 6.4)</dd>
  <dt>libraries (They are included in package of pg_stats_reporter.)</dt>
  <dd><ul>
    <li>jQuery : 2.0.1</li>
    <li>jQuery UI : 1.10.2</li>
    <li>jquery-ui-timepicker-addon : 1.3</li>
    <li>dygraphs JavaScript Visualization Library : b839102723 (commit ID)</li>
    <li>jqPlot : 1.0.8 r1250</li>
    <li>tablesorter : 2.0.3</li>
    <li>Superfish : 1.7.2</li>
    <li>Smarty : 3.1.13</li>
  </ul></dd>
  <dt>Resolution</dt>
  <dd>1024x786(SXGA) or higher</dd>
</dl>

<h3 id="pg_stats_reporter_install">How to install pg_stats_reporter?</h3>
<p>Install rpm packages which has dependency by yum or rpm command. Install command example is under following.</p>
<pre>
$ su
/* Example of install command by yum. */
# yum install httpd php php-pgsql php-intl php-cli

/* Example of install command by rpm. */
# rpm -ivh httpd-2.2.15-15.el6_2.1.x86_64.rpm \
           php-common-5.3.3-3.el6_2.8.x86_64.rpm \
           php-5.3.3-3.el6_2.8.x86_64.rpm \
           php-pdo-5.3.3-22.el6.x86_64.rpm \
           php-pgsql-5.3.3-3.el6_2.8.x86_64.rpm \
           php-intl-5.3.3-3.el6_2.8.x86_64.rpm \
           php-cli-5.3.3-22.el6.x86_64.rpm

[caution1] php-intl rpm file is included under following directory in OS install disk 2.
  Packages/php-intl-5.3.3-22.el6.x86_64.rpm
[caution2] It can work without php-intl rpm file. However, it doesn't work feature of auto language detection.
</pre>
<p>Install pg_stats_reporter by rpm command. Install example is under following.</p>
<pre>
# rpm -ivh pg_stats_reporter-2.0.0-1.el6.noarch.rpm
</pre>
<p>Under following install example, it only uses feature of createing reports by command-line.
<pre>
$ su
/* Example of install command by yum. */
# yum install php-pgsql php-intl php-cli

/* Example of install command by rpm. */
# rpm -ivh php-common-5.3.3-3.el6_2.8.x86_64.rpm \
           php-pdo-5.3.3-22.el6.x86_64.rpm \
           php-pgsql-5.3.3-3.el6_2.8.x86_64.rpm \
           php-intl-5.3.3-3.el6_2.8.x86_64.rpm \
           php-cli-5.3.3-22.el6.x86_64.rpm

[caution1] php-intl rpm file is included under following directory in OS install disk 2.
  Packages/php-intl-5.3.3-22.el6.x86_64.rpm
[caution2] It can work without php-intl rpm file. However, it doesn't work feature of auto language detection.
</pre>
<p>Install pg_stats_reporter by rpm command. Install example is under following.</p>
<pre>
# rpm -ivh --nodeps pg_stats_reporter-2.0.0-1.el6.noarch.rpm
</pre>

<h3 id="initialize">Initial Setting</h3>
<h4>Configuration of repository database</h4>
<p>Edit configuration file for connecting repository database. Configuration method is <a href="#configuration">here</a>.<br/>
And sample of configuration is <a href="files/pg_stats_reporter.ini.sample">here</a>.</p>

<h4>Start HTTP Server</h4>
<p>If you would like to use Web reporting feature, start HTTP Server.</p>
<pre>
# service httpd start
</pre>

<h3 id="execute_test">Install Check</h3>
<h4>How to confirm to work Web reporting feature collectly?</h4>
<p>Check <a href="#execute_server">Usage of creating reports by Web browser</a>  and access HTTP server by your web browser. If you see report window of pg_stats_reporter, install is collectly finished.</p>

<h4>How to confirm to work creating reports by command-line collectly?</h4>
<p>Check <a href="#execute_command">Usage of creating reports by command-line</a> and show snapshot list on conmmad-line. If you see snapshot list, instakk is collectly finished.</p>

<h2 id="execute">Usage</h2>

<p>Pg_stats_reporter is visual and graphical report software for pg_statsinfo's statistical snapshot database.<br/>
You prepare installing pg_statsinfo before you use pg_stats_reporter.</p>

<h3 id="execute_server">Usage of creating reports by Web browser</h3>
<p>You access pg_stats_reporter.php by web browser.<br/>
When you access your report which is created by pg_stats_reporter by web browser, example of reports URL is under following.
</p>
<pre>
http://&lt;<I>hostname</I>&gt;/pg_stats_reporter/pg_stats_reporter.php
</pre>
<p>If you access above URL, you can see a pg_statsinfo's GUI.</p>
<br/>

<h4>Detail usage</h4>
<p>Detail usage on window is under following.</p>
<h5>report display</h5>
<img id="report_sample" src="image/pg_stats_reporter.png" width="800px;"/>
<br/>
<dl>
<dt>① : Button of create report</dt>
<dd>This button can create report and select term. More details is <a href="#dialog">"dialog of creating report and selecting term"</a> </dd>
<dt>② : Menu of repository databases</dt>
<dd>If you select a repository database in this menu, pg_stats_reporter displays management instances in this repository database.</dd>
<dt>③ : Menu of report instances</dt>
<dd>If you select a instance in this menu, pg_stats_reporter displays graphical reports in the instance.</dd>
<dt>④ : Botton of reload pg_stats_reporter.ini</dt>
<dd>If you push this button, pg_stats_reporter reload configuration file(pg_stats_reporter.ini) and create new report in latest setting.</dd>
<dt>⑤ : Menu of report items</dt>
<dd>If you select a item, pg_stats_reporter displays selective item in the report.</dd>
<dt>⑥ : Button of display or not left-side menu</dt>
<dd>If you push this button, left-side menu is displayed or not</dd>
<dt>⑦ : Help button</dt>
<dd>Display explanation which is how to see this table or graph.</dd>
</dl>
<br/>
<h4 id="dialog">Dialog of creating report and selecting term</h4>
<img src="image/dialog.png"/>
<br/>
<dl>
<dt>⑧ : Text box of begginnig date of report</dt>
<dd>Input beginning date of report in this box. If you select this box, pop up a calender dialog. </dd>
<dt>⑨ : Text box of end date of report</dt>
<dd>Input end date of report in this box. If you select this box, pop up a calender dialog. </dd>
<dt>⑩ : Button of create report</dt>
<dd>Create report in your inputting report term</dd>
<dt>⑪ : Cancel button</dt>
<dd>Cancel for creating report</dd>
</dl>

<h3 id="execute_command">Usage of creating reports by command-line</h3>

<h4>Createing report</h4>
<pre>$ pg_stats_reporter [-R DBNAME] [-i INSTANCEID] [-a] [-O DIRECTORY] [-b SNAPID] [-e SNAPID] [-B DATE] [-E DATE]</pre>

<p>Example of command is under following.<br/>
This sample of command shows creating report which is created from snapshot which is in repository database named sample, and it is default report setting.</p>
<ul>
  <li>Period of report is fist snapshot to final snapshot in default.</li>
  <li>Report target is all of monitoring instance.</li>
  <li>Report output target is in current directory.</li>
</ul>

<p>When you create reports, HTML reports and directories which are JavaScript libraries and CSS files are created in report output directory.</p>

<pre>$ pg_stats_reporter -R sample</pre>

<dl>
  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>Set repository database which you would like to create reports.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets top of repository database in your config file.</dd>

  <dt>-i, --instid=INSTANCEID=DBNAME</dt>
  <dd>Set the monitored instance which you would like to create reports.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets all of monitored instance in your repository database.</dd>

  <dt>-a, --all</dt>
  <dd>Show all reports item, if we set this option.</dd>

  <dt>-O, --outputdir=DIRECTORY</dt>
  <dd>Set reports output directory</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting outputs at current directory.</dd>
  <dd>If you select unexists directory, it creates new directory.</dd>

  <dt>-b, --beginid=SNAPID</dt>
  <dd>Set snapshot id which is begining of snapshot you would like to create report.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets start of the snapshot in the monitored instance. (*1) (*2)</dd>

  <dt>-e, --endid=SNAPID</dt>
  <dd>Set snapshot id which is end of snapshot you would like to create report.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets end of the snapshot in the monitored instance. (*1) (*2)</dd>

  <dt>-B, --begindate=DATE</dt>
  <dd>Set date which is beginning of snapshot you would like to create report.(YYYY-MM-DD HH:MI:SS format)</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets start of snapshot in the monitored instance. (*1) (*2)</dd>

  <dt>-E, --enddate=DATE</dt>
  <dd>Set date which is end of snapshot you would like to create report.(YYYY-MM-DD HH:MI:SS format)</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting sets end of the snapshot in the monitored instance. (*1) (*2)</dd>
</dl>

<p>
*1: Can not set snapshot id and date in a same.<br/>
*2: If you ommit period of snapshot, default setting sets from 0:00 a.m. of the day before to the present.
</p>

<h4>List of snapshot</h4>
<pre>$ pg_stats_reporter -l [-R DBNAME] [-i INSTANCEID]</pre>

<p>Sample command is under following.<br/>
Under following command example shows list of snapshots stored in sample database in the repository database.</p>
<pre>$ pg_stats_reporter -l -R sample</pre>

<dl>
  <dt>-l, --list</dt>
  <dd>Show list of snapshots, if you select this option.</dd>
  
  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>Set repository database which you would like to see list of snapshots.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting is top og repository database in config file.</dd>

  <dt>-i, --instid=INSTANCEID</dt>
  <dd>Set instance id which you would like to see list of snapshots.</dd>
  <dd>This option can be omitted. If you doesn't set this parameter, default setting is showing all of the monitored instance.</dd>
</dl>

<h4>Show list of moritored instances</h4>
<pre>$ pg_stats_reporter -L [-R DBNAME]</pre>

<p>Sample command is under following.<br/>
Under following command sample shows list of monitored instances submitted in "sample" database in repository database.</p>
<pre>$ pg_stats_reporter -L -R sample</pre>

<dl>
  <dt>-L, --dblist</dt>
  <dd>Select this option, show list of monitored instances.</dd>

  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>Set repository database which you would like to see list of monitored instances.</dd>
  <dd>This option can be omitted. If you don't set this parameter, default setting is top of repository database in your config file.</dd>
</dl>

<h4>Show snapshots size</h4>
<pre>$ pg_stats_reporter -s [-R DBNAME]</pre>

<p>Sample command is under following. The command example shows snapshots size in "sample" database stored in repository database.</p>
<pre>$ pg_stats_reporter -s -R sample</pre>

<dl>
  <dt>-s, --size</dt>
  <dd>Show snapshot size, if you use this option.</dd>

  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>Set repository database name which you want to confirm snapshot size</dd>
  <dd>This option can be omitted. If you don't set this parameter, default setting is top of repository database in your config file.</dd>
</dl>

<h4>Create an index of reports</h4>
<pre>$ pg_stats_reporter --index [-O DIRECTORY]</pre>

<p>Sample command is under following. In this sample command, create an index of report in /var/report directory.</p>
<pre>$ pg_stats_reporter --index -O /var/report</pre>

<dl>
  <dt>--index</dt>
  <dd>Create an index of reports, If you set this option and execute, create only an index of report not reports.</dd>

  <dt>-O, --outputdir=DIRECTORY</dt>
  <dd>Set output directory for created reports</dd>
  <dd>This option can be omitted. If you don't set this parameter, default setting is current directory.</dd>
</dl>

<h2 id="uninstall">Uninstall</h2>
<p>If you use rpm package, please command under following.<br/>If you use source package, please see INSTALL.en for details.</p>
<pre>
$ su
# rpm -e pg_stats_reporter-2.0.0-1.el6.noarch
</pre>
<br/>

<h2 id="configuration">Configuration</h2>
<p>Configuration file of pg_stats_reporter is "pg_stats_reporter.ini" in /etc directory.<br/>
Configuration file is composed mainly two sections which are global setting and repository database setting.</p>

<h3>Global setting</h3>
<p>Global setting is "[global_setting]" of section name.<br/>
If you install pg_stats_reporter from rpm package, you don't need to set global setting<br/>
If you install it only from source, set global setting. More detail is written in INSTALL.ja which is included source package.</p>

<h3>Setting of repository database</h3>
<p>Please set one setting section by one repository database server; Global settig section is repository database setting section.<br/>
The section name in repository database setting is be repository database name.</p>

<p>Configuration of repository database is under following.<br/>
Sample configuration is <a href="files/pg_stats_reporter.ini.sample">here</a></p>

<table>
<thead>
  <tr>
    <th>parameter</th>
    <th>kind of parameter</th>
    <th>Not set parameter</th>
    <th>Default setting</th>
    <th width="150">example</th>
    <th>description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>[<I>repository database</I>]</td>
    <td>character</td>
    <td>not omission</td>
    <td>not omission</td>
    <td>[repository1]</td>
    <td>Repository name at left-side menu in pg_stats_reporter.</td>
  </tr>

  <tr>
    <td>host</td>
    <td>host name or IP address</td>
    <td>(*1)</td>
    <td>NULL</td>
    <td>host = localhost</td>
    <td>Host name or IP address of repository database.</td>
  </tr>

  <tr>
    <td>port</td>
    <td>port number</td>
    <td>(*1)</td>
    <td>NULL</td>
    <td>port = 5432</td>
    <td>Port number of repository database cluster.</td>
  </tr>

  <tr>
    <td>dbname</td>
    <td>character</td>
    <td>(*1)</td>
    <td>(*1)</td>
    <td>dbname = postgres</td>
    <td>repository database name.Please set repository database in pg_statsinfo(Defalut repository database is 'postgres'.).</td>
  </tr>

  <tr>
    <td>username</td>
    <td>char</td>
    <td>(*1)</td>
    <td>(*1)</td>
    <td>username = postgres</td>
    <td>connect user for repository database. Please set user which has read permission in repository database.</td>
  </tr>

  <tr>
    <td>password</td>
    <td>char</td>
    <td>no password</td>
    <td>no password</td>
    <td>password = hogehoge</td>
    <td>connect password for repository database. If you use .pgpass, do not set this parameter.</li></td>
  </tr>

  <tr>
    <td>language</td>
    <td>auto/ja/en</td>
    <td>auto</td>
    <td>en</td>
    <td>language = ja</td>
    <td>language in reports. If you set auto, we use browser information for language setting. (*2)</td>
  </tr>

  <tr>
    <td>report item settings<br/>(summary ~ profiles)</td>
    <td>true/false</td>
    <td>true</td>
    <td>false</td>
    <td>summary = true</td>
    <td>If you set true, this report item is created.</td>
  </tr>
</tbody>
</table>
<br/>
<p>
(*1): If you do not set this parameter, please see <a href="http://www.postgresql.jp/document/9.2/html/libpq-connect.html#LIBPQ-PARAMKEYWORDS">PostgreSQL document</a>.<br/>
(*2): If it didn't install php-intl package, it will show messages in English.
</p>

<h2 id="restrictions">Cautions and restrictions</h2>
<p>pg_stats_reporter has cautions and restrictions under following. Please read it before you use.</p>
<ul>
  <li>In some distribution, HTTP Server's document root home directory is /home/user. You should confirm that .pgpass is not visible from web browser and check file's permission.</li>
  <li>If you didn't set default time zone at php.ini, it might not works well. Please set default time zone correctly at php.ini.</li>
  <li>pg_stats_reporter execute rounding off fractions, therefore very small value will transform zero value.</li>
  <li>We cannot use "/"  in Linux OS. Because it will transform to "\ / : * ? < > |" in Windows OS. If you use reports of pg_stats_reporter in both Linux OS and Windows OS, you must not use "/" character at section name in pg_stats_reporter.ini.</li>
  <li>Don't set section name "global setting" in pg_stats_reporter.ini. "global setting" is reserved keyword by other feature.</li>
</ul>

<h2 id="faq">FAQ</h2>
<h4>Q1. Pg_stats_reporter does not display in my web browser.</h4>
<dl>A1. You had better review setting which are firewall(iptables etc) and SE Linux.</dl>

<h4>Q2. error massage which is database connection error is displayed in my browser. What should I do?</h4>
<dl>A2. You had better review under following.<ul>
<li>Setting of "database connection" in pg_stats_reporter.ini</li>
<li>Connection setting in PostgreSQL (postgresql.conf, pg_hba.conf)</li>
</ul></dl>

<h4>Q3. I use Internet Explorer browser. But I think that createing report and display may not correctly.</h4>
<dl>A3. Internet Explore is not recommended browser. We recommend Firefox.</dl>

<h4>Q4. Does pg_stats_reporter supoort Apache HTTP Server's worker mode?</h4>
<dl>A4. It doesn't support it, because PHP package is recommend to use in prefork mode.</dl>

<h2 id="change">Changes from pg_stats_reporter 1.0</h2>
<p>Change points from pg_stats_reporter 1.0 is under following.</p>
<ul>
  <li>Add feature of creating report by command-line(CUI).</li>
  <ul>
    <li>Can create reports by crond in a period</li>
    <li>Create an index of report list together with a report.</li>
  </ul>
  <li>Add report item which is replication delay.</li>
  <li>Add highlight button for period of CHECKPOINT executed time at each graphs.</li>
  <li>Add report item which is unit of parameters in "Setting Parameters".</li>
  <li>Change animation setting in dygraphs</li>
  <li>Can works normally without php-intl rpm package.<br/>If you doesn't install php-intl rpm package, it shows messages in only English.</li>
</ul>
<br/>

<h2 id="seealso">See also</h2>
<a href="http://pgstatsinfo.projects.postgresql.org/pg_statsinfo-ja.html">pg_statsinfo</a> 
<br/><br/>
<h2 id="acknowledgment">Acknowledgements</h2>
<p>Pg_stats_reporter use under following libraries. Thank you for developper of libraries<br/>
<ul>
<li>jQuery : <a href="http://jquery.com/">http://jquery.com/</a></li>
<li>jQuery UI : <a href="http://jqueryui.com/">http://jqueryui.com/</a></li>
<li>jquery-ui-timepicker-addon : <a href="http://trentrichardson.com/examples/timepicker/">http://trentrichardson.com/examples/timepicker/</a></li>
<li>dygraphs JavaScript Visualization Library : <a href="http://dygraphs.com/">http://dygraphs.com/</a></li>
<li>jqPlot : <a href="http://www.jqplot.com/">http://www.jqplot.com/</a></li>
<li>tablesorter : <a href="http://tablesorter.ru/docs/">http://tablesorter.ru/docs/</a></li>
<li>Superfish : <a href="http://users.tpg.com.au/j_birch/plugins/superfish/">http://users.tpg.com.au/j_birch/plugins/superfish/</a></li>
<li>Smarty : <a href="http://www.smarty.net/">http://www.smarty.net/</a></li>
</ul>
<br/><br/>
<hr/>
<div class="navigation">
  <a href="http://pgstatsinfo.projects.postgresql.org/index_ja.html">Top</a> &gt;
  <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter-ja.html">pg_stats_reporter</a>
</div>
<p class="footer">Copyright (c) 2012,2013, NIPPON TELEGRAPH AND TELEPHONE CORPORATION</p>

<script type="text/JavaScript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/JavaScript'%3E%3C/script%3E"));
</script>
<script type="text/JavaScript">
try{
var pageTracker = _gat._getTracker("UA-10244036-6");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
