<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="ja"><head>

<title>pg_stats_reporter 10</title>
<link rel="home" title="pg_stats_reporter" href="index.html">
<link rel="stylesheet" TYPE="text/css" href="style.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
<div class="index">
<ol>
  <li><a href="#name">pg_stats_reporter とは？</a></li>
  <li><a href="#synopsis">機能概要</a>
  <ol>
    <li><a href="#synopsis_server">Webレポート機能</a></li>
    <li><a href="#synopsis_command">コマンドライン機能</a></li>
  </ol></li>
  <li><a href="#install">インストール</a>
  <ol>
    <li><a href="#requirement">動作確認環境</a></li>
    <li><a href="#pg_stats_reporter_install">パッケージのインストール</a></li>
    <li><a href="#initialize">初期設定</a></li>
    <li><a href="#execute_test">動作確認</a></li>
  </ol></li>
  <li><a href="#execute">操作方法</a>
  <ol>
    <li><a href="#execute_server">Webレポート機能の操作方法</a></li>
    <li><a href="#execute_command">コマンドライン機能の操作方法</a></li>
  </ol></li>
  <li><a href="#uninstall">アンインストール</a></li>
  <li><a href="#configuration">設定ファイル</a></li>
  <li><a href="#restrictions">使用上の注意と制約</a></li>
  <li><a href="#faq">よくあるQ&amp;A</a></li>
  <li><a href="#change">pg_stats_reporter 3.3 からの変更点</a></li>
  <li><a href="#seealso">関連項目</a></li>
  <li><a href="#acknowledgment">謝辞</a></li>
</ol>
</div>
<h1 id="pg_stats_reporter">pg_stats_reporter 10</h1>
<h2 id="name">pg_stats_reporter とは?</h2>
<p><a href="http://pgstatsinfo.sourceforge.net/documents/statsinfo10/pg_statsinfo-ja.html">pg_statsinfo-10 </a>が収集した統計情報を元に、PostgreSQL サーバの利用統計情報をHTML形式のグラフィカルなレポートで出力します。</p>
<p>当ツールで作成したレポートの例は<a href="files/report_sample.html">こちら</a>をご覧ください。</p>

<h2 id="synopsis">機能概要</h2>
<p>pg_stats_reporter は pg_statsinfo が統計情報(以降、スナップショットと呼びます)を蓄積しているデータベース(以降、リポジトリDBと呼びます)からレポート作成に必要な情報を取得し、HTML形式のグラフィカルなレポートを作成します。</p>
<p>pg_stats_reporter を利用する際には、以下の２つのレポート作成機能があります。</p>

<h3 id="synopsis_server">Webレポート機能</h3>
<p>Webレポート機能では、Apache HTTP Server と連携して pg_stats_reporter が動作します。<br/>
WEBサーバにブラウザを利用してアクセスすることで、ブラウザ上での操作によりレポートを作成することが可能です。</p>
<p>Webレポート機能が作成するレポートの種類を以下に示します。</p>
<dl>
  <dt>性能レポート</dt>
  <dd>データベースの性能に関する統計情報やOSリソースの使用状況などが表示されます。</dd>
  <dt>ログレポート</dt>
  <dd>データベースのログおよび pg_statsinfo で検出したアラートが表示されます。また、特定のログを検索することができます。</dd>
</dl>

<h3 id="synopsis_command">コマンドライン機能</h3>
<p>コマンドライン機能では、端末上でのコマンド実行により性能レポートを作成することができます。<br/>
コマンドライン機能の利用には Apache HTTP Server を必要としません。何らかの理由でApache HTTP Serverを実行出来ない場合や、crond等で一定期間のレポートを日々作成したい場合に特にお勧めします。</p>

<h2 id="install">インストール</h2>
<p>pg_stats_reporter のインストールについて説明します。インストールパッケージは<a href="http://sourceforge.net/projects/pgstatsinfo/files/pg_stats_reporter/">こちら</a>からダウンロードしてください。<br/>ソースセットからインストールする場合は、ソースセットに同梱されている INSTALL.ja ファイルを参照してください。</p>

<h3 id="requirement">動作確認環境</h3>
<dl>
  <dt>pg_statsinfo</dt>
  <dd>バージョン 10</dd>
  <dt>動作確認済みPHP</dt>
  <dd>バージョン 5.4.16 (RHEL 7.4 同梱のもの)</dd>
  <dt>動作確認済みOS</dt>
  <dd>RHEL 7.4</dd>
  <dt>動作確認済みブラウザ</dt>
  <dd>Firefox : 57.0</dd>
  <dd>Internet Explorer : 11</dd>
  <dt>動作確認済みHTTP Server</dt>
  <dd>Apache HTTP Server : 2.4.6 (RHEL 7.4 同梱のもの)</dd>
  <dt>利用ライブラリ (pg_stats_reporter のインストールパッケージに同梱)</dt>
  <dd><ul>
    <li>jQuery : 3.2.1</li>
    <li>jQuery UI : 1.12.1</li>
    <li>jquery-ui-timepicker-addon : 1.6.3</li>
    <li>dygraphs JavaScript Visualization Library : 2.1.0</li>
    <li>jqPlot : 1.0.8 r1250</li>
    <li>tablesorter : 2.29.3</li>
    <li>Superfish : 1.7.9</li>
    <li>Smarty : 3.1.30</li>
  </ul></dd>
  <dt>ディスプレイ解像度</dt>
  <dd>1024x786(SXGA)以上推奨</dd>
</dl>

<h3 id="pg_stats_reporter_install">パッケージのインストール</h3>
<h4>フルインストール</h4>
<p>全ての機能を使用する場合は、ルートユーザで以下のいずれかの手順を実行してください。</p>

<h5>yumを使用する場合のインストール手順</h5>
<pre>
# yum install httpd php php-pgsql php-intl php-cli
# rpm -ivh pg_stats_reporter-10.0-1.el7.noarch.rpm
</pre>
<h5>yumを使用しない場合のインストール手順</h5>
<pre>
# rpm -ivh httpd-2.4.6-67.el7.x86_64.rpm \
           php-common-5.4.16-43.el6.x86_64.rpm \
           php-5.4.16-43.el7.x86_64.rpm \
           php-pdo-5.4.16-43.el7.x86_64.rpm \
           php-pgsql-5.4.16-43.el7.x86_64.rpm \
           php-intl-5.4.16-43.el7.x86_64.rpm \
           php-cli-5.4.16-43.el7.x86_64.rpm \
           pg_stats_reporter-10.0-1.el7.noarch.rpm
</pre>

<h4>コマンドライン機能のみ</h4>
<p>コマンドライン機能のみを使用する場合は、ルートユーザで以下のいずれかの手順を実行してください。</p>

<h5>yumを使用する場合のインストール手順</h5>
<pre>
# yum install php-pgsql php-intl php-cli
# rpm -ivh --nodeps pg_stats_reporter-10.0-1.el7.noarch.rpm
</pre>
<h5>yumを使用しない場合のインストール手順</h5>
<pre>
# rpm -ivh php-common-5.4.16-43.el7.x86_64.rpm \
           php-pdo-5.4.16-43.el7.x86_64.rpm \
           php-pgsql-5.4.16-43.el7.x86_64.rpm \
           php-intl-5.4.16-43.el7.x86_64.rpm \
           php-cli-5.4.16-43.el7.x86_64.rpm
# rpm -ivh --nodeps pg_stats_reporter-10.0-1.el7.noarch.rpm
</pre>

<p>
※php-intl のRPMパッケージの入手は、Red Hat カスタマーポータルのサブスクリプション管理サービスを用いる必要があります。<br/>
※php-intl が未インストールの状態でも動作しますが、表示言語の自動設定が機能しなくなります。
</p>

<h3 id="initialize">初期設定</h3>
<h4>リポジトリDBの起動</h4>
<p>リポジトリDBが停止している場合は、リポジトリDBを起動します。</p>

<h4>リポジトリDBの設定</h4>
<p>設定ファイルを編集し、リポジトリDBへの接続情報を設定します。設定ファイルの説明は<a href="#configuration">こちら</a>を参照してください。<br/>
設定例は<a href="files/pg_stats_reporter.ini.sample">こちら</a>を参照してください。</p>

<h4>HTTP Serverの起動</h4>
<p>Webレポート機能を使用する場合は、HTTP Server を起動します。</p>
<pre>
# service httpd start
</pre>
<p>RHEL 7の場合は、以下のコマンドを実行して起動します。</p>
<pre># systemctl start httpd.service</pre>
<p>OS 起動時に HTTP Server を自動的に起動させる場合は以下のコマンドを実行します。</p>
<pre>
# chkconfig httpd on
</pre>
<p>RHEL 7の場合は、以下のコマンドを実行します。</p>
<pre># systemctl enable httpd.service</pre>

<h3 id="execute_test">動作確認</h3>
<h4>Webレポート機能の動作確認</h4>
<p><a href="#execute_server">Webレポート機能の操作方法</a>の手順に従い HTTP Server にアクセスし、レポート画面が表示されることを確認してください。</p>

<h4>コマンドライン機能の動作確認</h4>
<p><a href="#execute_command">コマンドライン機能の操作方法</a>の手順に従いスナップショット一覧表示を実行し、スナップショット一覧が表示されることを確認してください。</p>
	

<h2 id="execute">操作方法</h2>

<p>ここでは、pg_stats_reporter の操作方法を説明します。</p>

<h3 id="execute_server">Webレポート機能の操作方法</h3>
<p>ブラウザから下記のURLにアクセスします。<br/>
URLのホスト名は pg_stats_reporter の実行環境にあわせて変更してください。<br/>
</p>
<pre>
http://&lt;<I>ホスト名</I>&gt;/pg_stats_reporter/pg_stats_reporter.php
</pre>
<p>上記のURLにアクセスすると、初期状態の性能レポートが表示されます。</p>
<br/>

<h4>操作方法詳細</h4>
<p>画面の操作方法を以下に示します。</p>
<h5>性能レポート画面</h5>
<img id="report_sample" src="image/report_sample.png" width="800px;"/>
<br/>
<dl>
<dt>① : Create new report ボタン</dt>
<dd>レポート作成期間を変更します。詳細は<a href="#dialog">レポート作成期間指定ダイアログ</a>を参照してください。</dd>
<dt>② : リポジトリDB選択メニューのリポジトリ選択</dt>
<dd>選択すると、アコーディオン形式でリポジトリDBで管理している監視対象DBの情報を表示/非表示します。</dd>
<dt>③ : リポジトリDB選択メニューの監視対象DB</dt>
<dd>選択すると、現在表示中のレポートと同じ期間で該当の監視対象DBのレポートを表示します。</dd>
<dt>④ : Reload config ボタン</dt>
<dd>設定ファイルの再読み込みを行います。読み込み後は表示中のレポートと同様の条件でレポートを表示します。</dd>
<dt>⑤ : ヘッダメニュー</dt>
<dd>"Overview" ～ "Misc" の項目を選択すると、性能レポートの該当項目へ移動します。</dd>
<dd>"Log Viewer" を選択すると、ログレポート画面に移動します。</dd>
<dt>⑥ : トップに移動ボタン</dt>
<dd>レポートのトップに移動します。</dd>
<dt>⑦ : メニュー表示/非表示ボタン</dt>
<dd>ボタンを押すごとに、左側のメニューの表示/非表示が切り替わります。</dd>
<dt>⑧ : ヘルプボタン</dt>
<dd>表やグラフの簡単な説明が表示されます。</dd>
</dl>
<br/>
<h4 id="dialog">レポート作成期間指定ダイアログ</h4>
<img src="image/dialog.png"/>
<br/>
<dl>
<dt>⑨ : レポート期間開始日時指定ボックス</dt>
<dd>レポート期間の開始年月日を入力します。選択すると、日時指定のダイアログボックスが表示されます。</dd>
<dt>⑩ : レポート期間終了日時指定ボックス</dt>
<dd>レポート期間の終了年月日を入力します。選択すると、日時指定のダイアログボックスが表示されます。</dd>
<dt>⑪ : Create report ボタン</dt>
<dd>入力した期間でレポートを作成します。</dd>
<dt>⑫ : Cancel ボタン</dt>
<dd>レポート期間の指定をキャンセルします。</dd>
</dl>

<h5>ログレポート画面</h5>
<img id="log_viewer_sample" src="image/log_viewer_sample.png" width="800px;"/>
<br/>
<dl>
<dt>① : 検索オプション表示／非表示ボタン</dt>
<dd>ボタンを押すごとに、検索オプションの表示/非表示が切り替わります。</dd>
<dt>② : 検索条件の入力フィールド</dt>
<dd>ログの検索条件を選択／指定するフィールドです。各フィールドの説明を以下に示します。
<ul>
<li>ELEVEL: メッセージレベル</li>
<li>USERNAME: DBユーザ名</li>
<li>DATABASE: データベース名</li>
<li>MESSAGE: メッセージ本文 (<a href="http://www.postgresql.jp/document/current/html/functions-matching.html#FUNCTIONS-POSIX-REGEXP">PostgreSQLの正規表現</a>で指定してください)</li>
</ul></dd>

<dt>③ : 検索ボタン</dt>
<dd>②に入力されている条件で検索を実行します。</dd>
<dt>④ : 検索条件のリセットボタン</dt>
<dd>②の全フィールドをリセットします。</dd>
<dt>⑤ :カラム表示／非表示ボタン</dt>
<dd>ボタンを押すと、表の各カラムの表示／非表示を選択するチェックボックスが表示されます。<br/>
チェックボックスのON/OFFを切り替えることで該当カラムの表示／非表示が切り替わります。<br/>
チェックボックスの表示を閉じるには再度ボタンを押してください。</dd>
<dt>⑥ : テーブルフィルタのリセットボタン</dt>
<dd>⑧の全フィールドをクリアします。</dd>
<dt>⑦ : ページ移動ボタン</dt>
<dd>表のページを前後に移動します。</dd>
<dt>⑧ : テーブルフィルタ</dt>
<dd>各フィールドに条件を入力することで、現在のページ内の条件に該当するレコードのみが表示されます。<br/>
条件には、tablesorter のパターンマッチ記述が使用できます。パターンマッチ記述の詳細は <a href="http://mottie.github.io/tablesorter/docs/example-widget-filter.html"> こちら </a> をご覧ください。</dd>
<dt>⑨ : ヘルプボタン</dt>
<dd>ログの検索方法および表の説明が表示されます。</dd>
</dl>

<h3 id="execute_command">コマンドライン機能の操作方法</h3>

<h4>レポート作成</h4>
<pre>$ pg_stats_reporter [-R DBNAME] [-i INSTANCEID] [-a] [-O DIRECTORY] [-b SNAPID] [-e SNAPID] [-B DATE] [-E DATE]</pre>

<p>以下にコマンド例を示します。<br/>
コマンド例では、リポジトリDB名 "sample" のリポジトリDBのスナップショットを元に、以下の条件のレポートを出力します。</p>
<ul>
  <li>レポート範囲は前日の午前0時から現在日時の範囲</li>
  <li>レポート対象は全ての監視対象インスタンス</li>
  <li>レポートの出力先はカレントディレクトリ</li>
</ul>

<p>なお、レポートの出力先ディレクトリにはHTML形式のレポートファイルの他に、CSSおよびJavaScriptが作成されます。</p>

<pre>$ pg_stats_reporter -R sample</pre>

<dl>
  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>レポート対象の監視対象インスタンスのスナップショットを保持するリポジトリDBの名前を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は設定ファイルの先頭のリポジトリDBを使用します。</dd>

  <dt>-i, --instid=INSTANCEID=DBNAME</dt>
  <dd>レポート対象とする監視対象インスタンスの識別子を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は全ての監視対象インスタンスがレポート対象です。</dd>

  <dt>-a, --all</dt>
  <dd>本オプションが指定された場合は、強制的に全てのレポート項目を表示します。</dd>

  <dt>-O, --outputdir=DIRECTORY</dt>
  <dd>レポートの出力先ディレクトリを指定します。</dd>
  <dd>本オプションは省略可能です。省略時はカレントディレクトリに出力します。</dd>
  <dd>指定されたディレクトリが存在しない場合は作成します。</dd>

  <dt>-b, --beginid=SNAPID</dt>
  <dd>レポート範囲の開始点とするスナップショットをスナップショットIDで指定します。</dd>
  <dd>本オプションは省略可能です。省略時は最初のスナップショットを開始点とします。(*a) (*b)</dd>

  <dt>-e, --endid=SNAPID</dt>
  <dd>レポート範囲の終了点とするスナップショットをスナップショットIDで指定します。</dd>
  <dd>本オプションは省略可能です。省略時は最後のスナップショットを終了点とします。(*a) (*b)</dd>

  <dt>-B, --begindate=DATE</dt>
  <dd>レポート範囲の開始点とするスナップショットを日時 (YYYY-MM-DD HH:MI:SS形式) で指定します。</dd>
  <dd>本オプションは省略可能です。省略時は最初のスナップショットを開始点とします。(*a) (*b)</dd>

  <dt>-E, --enddate=DATE</dt>
  <dd>レポート範囲の終了点とするスナップショットを日時 (YYYY-MM-DD HH:MI:SS形式) で指定します。</dd>
  <dd>本オプションは省略可能です。省略時は最後のスナップショットを終了点とします。(*a) (*b)</dd>
</dl>

<p>
<ol type="a">
  <li>スナップショットID指定と日時指定を混在して指定することはできません。</li>
  <li>レポート範囲の開始点と終了点の両方が省略された場合は、前日の午前0時から現在日時の範囲とします。</li>
</ol>
</p>

<h4>スナップショット一覧表示</h4>
<pre>$ pg_stats_reporter -l [-R DBNAME] [-i INSTANCEID]</pre>

<p>以下にコマンド例を示します。<br/>
コマンド例では、リポジトリDB名 "sample" のリポジトリDBに蓄積されているスナップショットの一覧を表示します。</p>
<pre>$ pg_stats_reporter -l -R sample</pre>

<dl>
  <dt>-l, --list</dt>
  <dd>本オプションが指定された場合はスナップショット一覧を表示します。</dd>
  
  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>スナップショット一覧を表示するリポジトリDBの名前を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は設定ファイルの先頭のリポジトリDBを使用します。</dd>

  <dt>-i, --instid=INSTANCEID</dt>
  <dd>スナップショット一覧を表示する監視対象インスタンスの識別子を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は全ての監視対象インスタンスのスナップショット一覧を表示します。</dd>
</dl>

<h4>監視対象インスタンス一覧表示</h4>
<pre>$ pg_stats_reporter -L [-R DBNAME]</pre>

<p>以下にコマンド例を示します。<br/>
コマンド例では、リポジトリDB名 "sample" のリポジトリDBに登録されている監視対象インスタンスの一覧を表示します。</p>
<pre>$ pg_stats_reporter -L -R sample</pre>

<dl>
  <dt>-L, --dblist</dt>
  <dd>本オプションが指定された場合は監視対象インスタンス一覧を表示します。</dd>

  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>監視対象インスタンス一覧を表示するリポジトリDBの名前を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は設定ファイルの先頭のリポジトリDBを使用します。</dd>
</dl>

<h4>スナップショットサイズ表示</h4>
<pre>$ pg_stats_reporter -s [-R DBNAME]</pre>

<p>以下にコマンド例を示します。<br/>
コマンド例では、リポジトリDB名 "sample" のリポジトリDBに蓄積されているスナップショットのサイズを表示します。</p>
<pre>$ pg_stats_reporter -s -R sample</pre>

<dl>
  <dt>-s, --size</dt>
  <dd>本オプションが指定された場合はスナップショットサイズを表示します。</dd>

  <dt>-R, --repositorydb=DBNAME</dt>
  <dd>スナップショットサイズを表示するリポジトリDBの名前を指定します。</dd>
  <dd>本オプションは省略可能です。省略時は設定ファイルの先頭のリポジトリDBを使用します。</dd>
</dl>

<h4>インデックス作成</h4>
<pre>$ pg_stats_reporter --index [-O DIRECTORY]</pre>

<p>以下にコマンド例を示します。<br/>
コマンド例では、ディレクトリ名 "/var/report" 直下に存在するレポートのインデックスを作成します。</p>
<pre>$ pg_stats_reporter --index -O /var/report</pre>

<dl>
  <dt>--index</dt>
  <dd>本オプションが指定された場合はレポートのインデックスを作成します。</dd>

  <dt>-O, --outputdir=DIRECTORY</dt>
  <dd>レポートの出力先ディレクトリを指定します。</dd>
  <dd>本オプションは省略可能です。省略時はカレントディレクトリが適用されます。</dd>
</dl>

<h2 id="uninstall">アンインストール</h2>
<p>rpm コマンドでアンインストールします。<br/>
なお、アンインストールにより設定ファイル(/etc/pg_stats_reporter.ini)は削除されません。設定ファイルを削除したい場合は手動で削除してください。</p>
<pre>
$ su
# rpm -e pg_stats_reporter-10.0-1.el7.noarch
</pre>
<p>ソースセットからインストールした場合のアンインストール手順は、ソースセットに同梱されている INSTALL.ja ファイルを参照してください。</p>

<h2 id="configuration">設定ファイル</h2>
<p>設定ファイルは、"/etc" に "pg_stats_reporter.ini" という名称で配置されています。<br/>
設定ファイルの内容は、グローバル設定とリポジトリDB設定の2種類のセクションで構成されています。<br/>リポジトリDB設定を複数記述することで、複数のレポートをサイドバーで選択することで、切り替えて表示することができます。</p>

<h3>グローバル設定</h3>
<p>グローバル設定は、セクション名 "[global_setting]" のセクションの設定項目です。</p>
<p>グローバル設定のセクションの設定項目を以下に示します。</p>

<table width="100%">
<thead>
  <tr>
    <th>設定項目</th>
    <th>設定可能な値</th>
    <th>デフォルト</th>
    <th>設定例</th>
    <th>説明</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>install_directory</td>
    <td>文字列</td>
    <td>省略不可</td>
    <td>install_directory = /var/www</td>
    <td>当ツールのインストールディレクトリを指定します。(*a)</td>
  </tr>

  <tr>
    <td>log_page_size</td>
    <td>1 - 1000</td>
    <td align="right">1000</td>
    <td>log_page_size = 1000</td>
    <td>ログレポート画面の表のページ毎の最大表示件数を指定します。</td>
  </tr>
</tbody>
</table>

<p>
<ol type="a">
  <li>RPMパッケージからインストールした場合は変更する必要はありません。ソースセットからインストールした場合のみ変更してください。</li>
</ol>
</p>

<h3>リポジトリDB設定</h3>
<p>グローバル設定以外のセクションがリポジトリDB設定のセクションとなり、1個のリポジトリDBにつき1個のセクションで設定項目を記述します。<br/>
この時、リポジトリDB設定のセクション名がリポジトリDB名となります。</p>

<p>リポジトリDB設定のセクションの設定項目を以下に示します。<br/>
記述例は<a href="files/pg_stats_reporter.ini.sample">こちら</a>を参照してください。</p>

<table>
<thead>
  <tr>
    <th>設定項目</th>
    <th>設定可能な値</th>
    <th>デフォルト</th>
    <th>設定例</th>
    <th>説明</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>[<I>リポジトリDB名</I>]</td>
    <td>文字列</td>
    <td>省略不可</td>
    <td>[repository1]</td>
    <td>左側のリポジトリ選択メニューに表示するリポジトリDBの名称を指定します。</td>
  </tr>

  <tr>
    <td>host</td>
    <td>ホスト名または IP アドレス</td>
    <td>(*a)</td>
    <td>host = localhost</td>
    <td>接続するリポジトリDBのホストを指定します。指定するホスト名は、PostgreSQLが受け付ける形式で指定する必要があります。</td>
  </tr>

  <tr>
    <td>port</td>
    <td>ポート番号</td>
    <td>(*a)</td>
    <td>port = 5432</td>
    <td>接続するリポジトリDBのポート番号を指定します。PostgreSQL の待ち受けポートを指定してください。</td>
  </tr>

  <tr>
    <td>dbname</td>
    <td>文字列</td>
    <td>(*a)</td>
    <td>dbname = postgres</td>
    <td>接続するリポジトリDBのデータベース名を指定します。pg_statsinfo でリポジトリDBとして使用しているデータベースの名称を指定してください。</td>
  </tr>

  <tr>
    <td>username</td>
    <td>文字列</td>
    <td>(*a)</td>
    <td>username = postgres</td>
    <td>リポジトリDBに接続するDBユーザの名称を指定します。リポジトリDBに参照権限のあるDBユーザの名称を指定してください。</td>
  </tr>

  <tr>
    <td>password</td>
    <td>文字列</td>
    <td>パスワード指定なし</td>
    <td>password = abc</td>
    <td>リポジトリDBへの接続で使用するパスワードを指定します。PostgreSQL への接続パスワードを .pgpass を使用して設定する場合は、値を設定しないでください。(*b)</li></td>
  </tr>

  <tr>
    <td>language</td>
    <td>auto/ja/en</td>
    <td>auto</td>
    <td>language = ja</td>
    <td>レポートの表示言語の言語タグを設定します。auto を設定した場合は、表示するブラウザの設定を使用します。指定した言語に対応するメッセージが存在しない場合は英語で表示します。(*c)</td>
  </tr>

  <tr>
    <td>表示項目<br/>(overview - profiles)(*d)</td>
    <td>true/false</td>
    <td>true</td>
    <td>overview = true</td>
    <td>レポートに項目の表示/非表示を bool 値で設定します。</td>
  </tr>
</tbody>
</table>

<p>
<ol type="a">
  <li>項目または設定値を省略した場合の挙動は、libpqの接続文字列のパラメータと同じです。詳しくは <a href="http://www.postgresql.jp/document/current/html/libpq-connect.html#LIBPQ-PARAMKEYWORDS">こちら</a> を参照してください。</li>
  <li>ディストリビューションによっては、HTTP Server のドキュメントルートのデフォルトが実行ユーザのホームディレクトリになっている場合があります。そのため、PostgreSQL の接続パスワードで .pgpass を使用する場合には、外部から参照されないように注意して配置してください。</li>
  <li>php-intl が未インストールの状態状態では、表示言語の自動設定は動作せず、en となります。</li>
  <li>各種レポート項目は、<a href="files/pg_stats_reporter.ini.sample">pg_stats_reporter.iniファイルのサンプル</a>を参照してください。</li>
</ol>
</p>

<h2 id="restrictions">使用上の注意と制約</h2>
<p>pg_stats_reporter を使用する際には、以下の使用上の注意と制約があります。</p>
<ul>
  <li>PHP の設定ファイル (php.ini) にデフォルトのタイムゾーンが設定されていない場合、実行環境のロケールによっては正しく動作しない可能性があります。php.ini にデフォルトのタイムゾーン (date.timezone) を設定することを推奨します。</li>
  <li>データサイズなどを示す一部の項目の値は、単位換算での数値の切り捨てによりゼロと表示される可能性があります。</li>
  <li>Linux環境では "/" が、Windowsのエクスプローラでは "\ / : * ? &lt; &gt; |" の8種類の文字がファイル名の制約となるため、セクション名で使用できません。そのため、Linux と Windows の両方の環境にてpg_stats_reporter を使用する場合は正常に動作しない可能性があります。</li>
  <li>グローバルな設定項目用のセクション名として利用しているため、リポジトリDB設定のセクション名として "global_setting" を設定しないでください。</li>
  <li>監視対象となっているPostgreSQLサーバ上で、監視対象DB以外において大量のSQLクエリが実行された場合、当ツールが作成するレポートの Query Activity に、監視対象DBで実行されたSQLクエリの情報が表示されないことがあります。これは、pg_statsinfo は pg_stat_statements を利用してクエリの実行情報を収集しており、監視対象DB以外に total_time が長いクエリが多数ある場合に、監視対象DBに対するクエリの実行情報が押し出されてしまうためです。同様に、監視対象DB上で、レポート作成期間外に total_time が長いクエリが多数ある場合、レポート作成期間内に実行されたクエリが表示されなくなることがあります。</li>
  <li>pg_statsinfo で監視対象とするデータベースは <a href="http://pgstatsinfo.sourceforge.net/documents/statsinfo10/pg_statsinfo-ja.html">excluded_dbnames</a> で制限することができるようになっています。しかし現在の実装ではロングトランザクション情報など一部の情報で、これらの制限されたデータベースの情報を表示するものがあります。</li>
</ul>

<h2 id="faq">よくあるQ&amp;A</h2>
<h4>Q1. pg_stats_reporter の画面が表示されません。</h4>
<p>A1. ファイアウォール、SELinuxの設定、および PHP のメモリ使用上限設定を必要に応じて変更してください。</p>

<ul>
<li>ファイアウォールでは、httpd のポートへのアクセスを許可する必要があります。</li>

<li>SELinux については、httpd_can_network_connect_db の設定が on に、また pg_stats_reporter が書き込みを行うディレクトリの SELinuxファイルタイプが httpd_sys_rw_context_t になっている必要があります. 現在の設定は以下のようにして確認できます。

<pre>getsebool httpd_can_network_connect_db
ls -dZ /var/www/pg_stats_reporter_lib/{cache,compiled}
</pre>
</li>

<li>PHP のメモリ使用上限は、/etc/php.ini の memory_limit で設定します。 変更後は httpd を再起動してください。</li>
</ul>

<h4>Q2. データベース接続失敗のエラーが表示されて、pg_stats_reporter の画面が表示されません。</h4>
<p>A2. 以下の2点を確認してください。<ul>
<li>pg_stats_reporter.ini に記述されている「database connection」の情報</li>
<li>接続先の PostgreSQL の設定 (postgresql.conf, pg_hba.conf)</li>
</ul></p>

<h4>Q3. ブラウザに Internet Explorer を使用してレポートを表示したところ、正しく表示されません。</h4>
<p>A3. ブラウザに Internet Explorer を使用してレポートを作成した場合、Internet Explorer のバージョンによって正しく表示されない場合があります。ブラウザは Firefox を使用することを推奨します。</p>

<h4>Q4. Apache HTTP Server の worker モードには対応していますか？</h4>
<p>A4. PHP の仕様のため、worker モードでの使用は推奨されません。prefork モードで使用するか、コマンドライン機能を使用してください。</p>

<h4>Q5. リポジトリDB選択メニューに現在未使用の監視対象DBが表示されます。</h4>
<p>A5. リポジトリDBから現在未使用の監視対象DBのインスタンス情報を削除してください。
インスタンス情報の削除方法は、pg_statsinfoマニュアルの「<a href="http://pgstatsinfo.sourceforge.net/documents/statsinfo10/pg_statsinfo-ja.html#user-operations">運用上必要となる作業</a>」を参照してください。</p>

<h4>Q6. レポートの表が正しく表示されません。</h4>
<p>A6. ブラウザ内にJavaScriptのキャッシュが残っているために、正しく表示されていない可能性があります。ブラウザのキャッシュの削除を試してみてください。</p>

<h2 id="change">pg_stats_reporter 3.3 からの変更点</h2>
<p>pg_stats_reporter 3.3 からの変更点は以下の通りです。</p>
<ul>
  <li>Replication Overview、Delays の表示を、レポート期間内に接続のあった全てのスタンバイの情報を表示するように修正</li>
  <li>ステートメント情報のクエリ全文表示ダイアログにおいて, 表示される内容が改行を含む場合にフォントサイズが小さくなる問題を修正</li>
  <li>Replication Overview にレプリケーション遅延時間を追加</li>
  <li>本バージョンから pg_stats_reporter は pg_statsinfo の複数バージョンサポートを廃止します。 pg_stats_repoter 10 は pg_statsinfo 10 のみに対応します</li>
</ul>
<br/>

<h2 id="seealso">関連項目</h2>
<a href="http://pgstatsinfo.sourceforge.net/documents/statsinfo10/pg_statsinfo-ja.html">pg_statsinfo 10</a> 
<br/><br/>
<h2 id="acknowledgment">謝辞</h2>
<p>pg_stats_reporter では、以下のライブラリを活用させていただいております。感謝いたします。<br/>
<ul>
<li>jQuery : <a href="http://jquery.com/">http://jquery.com/</a></li>
<li>jQuery UI : <a href="http://jqueryui.com/">http://jqueryui.com/</a></li>
<li>jquery-ui-timepicker-addon : <a href="http://trentrichardson.com/examples/timepicker/">http://trentrichardson.com/examples/timepicker/</a></li>
<li>dygraphs JavaScript Visualization Library : <a href="http://dygraphs.com/">http://dygraphs.com/</a></li>
<li>jqPlot : <a href="http://www.jqplot.com/">http://www.jqplot.com/</a></li>
<li>tablesorter : <a href="https://github.com/Mottie/tablesorter">https://github.com/Mottie/tablesorter</a></li>
<li>Superfish : <a href="https://superfish.joelbirch.co/">https://superfish.joelbirch.co/</a></li>
<li>Smarty : <a href="http://www.smarty.net/">http://www.smarty.net/</a></li>
</ul>
<br/><br/>
<hr/>
<div class="navigation">
  <a href="http://pgstatsinfo.sourceforge.net/index_ja.html">Top</a> &gt;
  <a href="http://pgstatsinfo.sourceforge.net/documents/reporter10/html/pg_stats_reporter-ja.html">pg_stats_reporter</a>
</div>
<p class="footer">Copyright (c) 2012-2018, NIPPON TELEGRAPH AND TELEPHONE CORPORATION</p>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-10244036-6");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
