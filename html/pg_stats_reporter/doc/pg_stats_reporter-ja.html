<!DOCTYPE html PUBLIC "-//W3C//DTD html 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>pg_stats_reporter</title>
<link rel="home" title="pg_stats_reporter" href="index.html">
<link rel="stylesheet" TYPE="text/css"href="style.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
<h1 id="pg_stats_reporter">pg_stats_reporter 1.0.0</h1>
<div class="navigation">
  <a href="http://pgstatsinfo.projects.postgresql.org/index_ja.html">Top</a> &gt;
  <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter-ja.html">pg_stats_reporter</a>
</div>
<hr/>

<div class="index">
<ol>
  <li><a href="#name">pg_stats_reporter とは？</a></li>
  <li><a href="#synopsis">機能概要</a></li>
  <li><a href="#install">インストール</a></li>
  <ol>
    <li><a href="#requirement">動作環境</a></li>
    <li><a href="#pg_stats_reporter_install">pg_stats_reporter のインストール</a></li>
    <li><a href="#initialize">初期設定</a></li>
    <li><a href="#execute_test">動作確認</a></li>
  </ol>
  <li><a href="#execute">操作方法</a></li>
  <li><a href="#uninstall">アンインストール</a></li>
  <li><a href="#configuration">設定ファイル</a></li>
  <li><a href="#restrictions">使用上の注意と制約</a></li>
  <li><a href="#faq">よくあるQ&amp;A</a></li>
  <li><a href="#seealso">関連項目</a></li>
</ol>
</div>

<h2 id="name">pg_stats_reporter とは?</h2>
<p><a href="http://pgstatsinfo.projects.postgresql.org/pg_statsinfo-ja.html">pg_statsinfo-2.4</a>で収集した統計情報(以降、スナップショットと呼びます)を使って、グラフィカルな出力が可能になります。<br/>
レポート例は<a href="files/">こちら</a>を参照してください。</p>

<h2 id="synopsis">機能概要</h2>
<p>pg_stats_reporter はブラウザから利用し、pg_statsinfo が PostgreSQL に格納したスナップショットからグラフィカルなレポートを作成し、表示します。<br/>

<h2 id="install">インストール</h2>
<p>pg_stats_reporter のインストールについて説明します。インストールパッケージは<a href="http://pgfoundry.org/frs/?group_id=1000422">こちら</a>からダウンロードしてください。</p>

<h3 id="requirement">動作環境</h3>
<dl>
  <dt>pg_statsinfo が監視対象とする PostgreSQL</dt>
  <dd>バージョン 8.3 以降
  <dt>pg_statsinfo</dt>
  <dd>バージョン 2.4 以降</dd>
  <dt>動作確認済みPHP (OS同梱のもの)</dt>
  <dd>バージョン 5.3.3</dd>
  <dt>動作確認済みOS</dt>
  <dd>RHEL 5.x, 6.x, CentOS 5.x, 6.x</dd>
  <dt>動作確認済みブラウザ</dt>
  <dd>Firefox : 3.6.9, 16.0.2</dd>
  <dt>動作確認済みHTTP Server (OS同梱のもの)</dt>
  <dd>Apache HTTP Server : 2.2.15</dd>
  <dt>利用ライブラリ(pg_stats_reporter の RPM に同梱)</dt>
  <dd><ul>
    <li>jQuery : 1.8.2</li>
    <li>jQuery UI : 1.9.1</li>
    <li>jquery-ui-timepicker-addon : 0.9.9</li>
    <li>dygraphs JavaScript Visualization Library : 4d3672f</li>
    <li>jqPlot : 1.0.4 r1121</li>
    <li>tablesorter : 2.0.3</li>
    <li>Superfish : 1.4.8</li>
    <li>Smarty : 3.1.12</li>
  </ul></dd>
  <dt>解像度</dt>
  <dd>1024x786(SXGA)以上推奨</dd>
</dl>

<h3 id="pg_stats_reporter_install">pg_stats_reporterのインストール</h3>
<p>入手した rpm ファイルを、rpm コマンドでインストールします。以下はインストールの例です。</p>
<pre>
$ su
# rpm -ivh pg_stats_reporter-1.0.0-1.el6.noarch.rpm
</pre>

<h3 id="initialize">初期設定</h3>
<h4>設定ファイルの作成</h4>
<p>サンプルから設定ファイルを作成します。設定ファイルの各項目の説明は<a href="#configuration">こちら</a>を参照してください。<br/>
「database connection」の各項目を、pg_statsinfo のスナップショット格納DB(以降、リポジトリDBと呼びます)への接続情報に修正します。複数のリポジトリDBの情報を参照できるようにしたい場合は、リポジトリDBごとにiniファイルにセクション(pg_stats_reporter.ini.sample ファイルの情報全て)を追加します。<br/>
以下は作成の例です。<br/>
</p>
<pre>
# cd /var/www/pg_stats_reporter
# vi pg_stats_reporter.ini
----- リポジトリDBへの接続情報に修正します -----
host = <I>localhost</I>
port = <I>5432</I>
dbname = <I>postgres</I>
username = <I>postgres</I>
password =
</pre>

<h3 id="execute_test">動作確認</h3>
<p>HTTP Server を起動し、<a href="#execute">操作方法</a>の手順に従いアクセスします。</p>
<pre>
# service httpd start
</pre>

<h2 id="execute">操作方法</h2>

<p>pg_stats_reporter は pg_statsinfo のリポジトリを表示させるためのものです。<br/>
前もって pg_statsinfo のリポジトリを準備してください。</p>

<h3>レポート表示</h3>
<p>ブラウザから pg_stats_reporter.php にアクセスします。<br/>
以下は pg_stats_reporter 実行環境でブラウザからアクセスするとき時のURLの例です。</p>
<pre>
http://localhost/pg_stats_reporter/pg_stats_reporter.php
</pre>
<p>起動時は、以下のレポートを表示します。<ul>
<li>対象リポジトリDB : 設定ファイルの先頭に記述されたもの</li>
<li>開始 : 実行日前日の0時</li>
<li>終了 : 実行日時</li>
</ul></p>
<pre>
リポジトリDB
  [sample1]
    localhost:5432
    host1:5432
  [sample2]
    localhost:5432
    host2:5432
起動日時
  2012/11/01 10:00:00

上記の場合に作成されるレポート
  [sample1]
  localhost:5432
  begin: 2012/10/31 00:00:00
  end: 2012/11/01 10:00:00
</pre>

<h3>操作方法詳細</h3>
<p>画面の操作方法を以下に示します。</p>
<h4>レポート画面</h4>
<img src="pg_stats_reporter.png" width="800px;"/>
<br/>
<dl>
<dt>① : Create report range ボタン</dt>
<dd>レポート作成期間を変更します。詳細は<a href="#dialog">レポート作成期間指定ダイアログ</a>を参照してください。</dd>
<dt>② : リポジトリDB選択メニューのリポジトリ選択</dt>
<dd>選択すると、アコーディオン形式でリポジトリDBで管理している監視対象DBの情報を表示/非表示します。</dd>
<dt>③ : リポジトリDB選択メニューの監視対象DB</dt>
<dd>選択すると、現在表示中のレポートと同じ期間で該当の監視対象DBのレポートを表示します。</dd>
<dt>④ : Reload pg_stats_reporter.ini ボタン</dt>
<dd>設定ファイルの再読み込みを行います。読み込み後は起動時と同様の条件でレポートを表示します。</dd>
<dt>⑤ : ヘッダメニュー</dt>
<dd>選択すると、レポートの該当項目へ移動します。</dd>
<dt>⑥ : メニュー表示/非表示ボタン</dt>
<dd>ボタンを押すごとに、左側のメニューの表示/非表示が切り替わります。</dd>
<dt>⑦ : ヘルプボタン</dt>
<dd>表やグラフの簡単な説明が表示されます。</dd>
</dl>
<br/>
<h4 id="dialog">レポート作成期間指定ダイアログ</h4>
<img src="dialog.png"/>
<br/>
<dl>
<dt>⑧ : レポート期間開始日時指定ボックス</dt>
<dd>レポート期間の開始年月日を入力します。選択すると、日時指定のダイアログボックスが表示されます。</dd>
<dt>⑨ : レポート期間終了日時指定ボックス</dt>
<dd>レポート期間の終了年月日を入力します。選択すると、日時指定のダイアログボックスが表示されます。</dd>
<dt>⑩ : Create report ボタン</dt>
<dd>入力した期間でレポートを作成します。</dd>
<dt>⑪ : Cancel ボタン</dt>
<dd>レポート期間の指定をキャンセルします。</dd>
</dl>
<br/>

<h2 id="uninstall">アンインストール</h2>
<p>rpm コマンドでアンインストールします。</p>
<pre>
$ su
# rpm -e pg_stats_reporter-1.0.0-1.el6.noarch
</pre>
<br/>

<h2 id="configuration">設定ファイル</h2>
<p>設定ファイル(pg_stats_reporter.ini)は、データベース接続情報およびレポート表示に関する設定を行うファイルです。<br/>設定項目を以下に示します。記述例は<a href="pg_stats_reporter.ini.sample">こちら</a>を参照してください。</p>

<table>
<thead>
  <tr>
    <th>設定項目</th>
    <th>設定可能な値</th>
    <th>項目省略時</th>
    <th>設定値省略時</th>
    <th>設定例</th>
    <th>説明</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>[<I>リポジトリDB名</I>]</td>
    <td>文字列</td>
    <td>省略不可</td>
    <td>空文字列</td>
    <td>[sample]</td>
    <td>左側のリポジトリ選択メニューに表示するリポジトリDBの名称を指定します。日本語を指定する場合はUTF-8で指定する必要がありますが、推奨しません。</td>
  </tr>

  <tr>
    <td>host</td>
    <td>ホスト名または IP アドレス</td>
    <td>-</td>
    <td>空文字列</td>
    <td>host = localhost</td>
    <td>接続するリポジトリDBのホストを指定します。指定するホスト名は、PostgreSQLが受け付ける形式で指定する必要があります。</td>
  </tr>

  <tr>
    <td>port</td>
    <td>ポート番号</td>
    <td>-</td>
    <td>空文字列</td>
    <td>port = 5432</td>
    <td>接続するリポジトリDBのポート番号を指定します。PostgreSQL の待ち受けポートを指定してください。</td>
  </tr>

  <tr>
    <td>dbname</td>
    <td>文字列</td>
    <td>-</td>
    <td>空文字列</td>
    <td>dbname = postgres</td>
    <td>接続するリポジトリDBのデータベース名を指定します。pg_statsinfo でリポジトリDBとして使用しているデータベースの名称を指定してください。</td>
  </tr>

  <tr>
    <td>username</td>
    <td>文字列</td>
    <td>-</td>
    <td>空文字列</td>
    <td>username = postgres</td>
    <td>リポジトリDBに接続するDBユーザの名称を指定します。リポジトリDBに参照権限のあるDBユーザの名称を指定してください。</td>
  </tr>

  <tr>
    <td>password</td>
    <td>文字列</td>
    <td>パスワード指定なし</td>
    <td>空文字列</td>
    <td>password =</td>
    <td>リポジトリDBへの接続で使用するパスワードを指定します。PostgreSQL への接続パスワードを .pgpass を使用して設定する場合は、値を設定しないでください。</li></td>
  </tr>

  <tr>
    <td>language</td>
    <td>auto/ja/en</td>
    <td>auto</td>
    <td>空文字列</td>
    <td>language = ja</td>
    <td>レポートの表示言語の言語タグを設定します。auto を設定した場合は、表示するブラウザの設定を使用します。指定した言語に対応するメッセージが存在しない場合は英語で表示します。</td>
  </tr>

  <tr>
    <td>表示項目<br/>(summary 〜 profiles)</td>
    <td>true/false</td>
    <td>true</td>
    <td>false</td>
    <td>summary = true</td>
    <td>レポートに項目の表示/非表示を bool 値で設定します。</td>
  </tr>
</tbody>
</table>
<br/>

<h2 id="restrictions">使用上の注意と制約</h2>
<p>pg_stats_reporter を使用する際には、以下の使用上の注意と制約があります。</p>
<ul>
  <li>ディストリビューションによっては、HTTP Server のドキュメントルートのデフォルトが実行ユーザのホームディレクトリになっている場合があります。そのため、PostgreSQL の接続パスワードで .pgpass を使用する場合には、外部から参照されないように注意して配置してください。</li>
</ul>

<h2 id="faq">よくあるQ&amp;A</h2>
<h4>Q1. pg_stats_reporter の画面が表示されません。</h4>
<dl>A1. ファイアウォール、および SELinux の設定が正しい設定となっているか見直してください。</dl>

<h4>Q2. データベース接続失敗のエラーが表示されて、pg_stats_reporter の画面が表示されません。</h4>
<dl>A2. 以下の2点を確認してください。<ul>
<li>pg_stats_reporter.ini に記述されている「database connection」の情報</li>
<li>接続先の PostgreSQL の設定 (postgresql.conf, pg_hba.conf)</li>
</ul></dl>

<h4>Q3. メニュー画面が画面からはみ出て選択できない。</h4>
<dl>A3. 画面の解像度を現在の設定以上に設定してください。右側のリポジトリ選択メニューが選択できない場合は、別のWebディレクトリにpg_stats_reporterをインストールして、レポジトリDB設定を分散させるなどして対応してください。</dl>

<h4>Q4. ブラウザに Internet Explorer を使用してレポートを表示したところ、正しく表示されません。</h4>
<dl>A4. ブラウザに Internet Explorer を使用してレポートを作成した場合、Internet Explorer のバージョンによって正しく表示されない場合があります。ブラウザは Firefox を使用することを推奨します。</dl>

<h4>Q5. 日時を指定してレポートを作成したところ、空のレポートが表示されました。</h4>
<dl>A5. 指定した条件に該当するスナップショット件数が2件未満の可能性があります。スナップショット件数が2件以上該当するように条件を変更してください。</dl>

<h2 id="seealso">関連項目</h2>
<a href="http://pgstatsinfo.projects.postgresql.org/pg_statsinfo-ja.html">pg_statsinfo</a> 
<br/><br/>
<hr/>
<div class="navigation">
  <a href="http://pgstatsinfo.projects.postgresql.org/index_ja.html">Top</a> &gt;
  <a href="http://pgstatsinfo.projects.postgresql.org/pg_stats_reporter-ja.html">pg_stats_reporter</a>
</div>
<p class="footer">Copyright (c) 2012, NIPPON TELEGRAPH AND TELEPHONE CORPORATION</p>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-10244036-6");
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
